	IFNDEF	C152INC
C152INC		EQU	TRUE
;****************************************************************************
;*                                                                          *
;*   AS 1.41 - 80C152.INC                                                   *
;*                                                                          *
;*   SFR- and bitdefinition for 80c152 microcontroller                      *
;*                                                                          *
;*   Last changes:                                                          *
;*                                                                          *
;*              25.07.2000      basic definitions                           *
;*                                                                          *
;****************************************************************************
		SAVE
		LISTING	OFF
		IF (MOMCPUNAME<>"87C750")&&(MOMCPUNAME<>"8051")&&(MOMCPUNAME<>"8052")&&(MOMCPUNAME<>"80C320")&&(MOMCPUNAME<>"80515")&&(MOMCPUNAME<>"80517")
			FATAL "incorrect processor type: only 87C750, 8051, 8052, 80C320, 80515 or 80517 allowed"
		ENDIF

		IF	MOMPASS=1
			MESSAGE "creating \{MOMCPU} SFRs definitions"
		ENDIF

;----------------------------------------------------------------------------
R0		SFR	000h
AR0		SFR	000h
R1		SFR	001h
AR1		SFR	001h
R2		SFR	002h
AR2		SFR	002h
R3		SFR	003h
AR3		SFR	003h
R4		SFR	004h
AR4		SFR	004h
R5		SFR	005h
AR5		SFR	005h
R6		SFR	006h
AR6		SFR	006h
R7		SFR	007h
AR7		SFR	007h

P0     SFRB 080H  ;PORT 0
SP     SFR  081H  ;STACK POINTER
DPL    SFR  082H  ;SFR POINTER - LOW BYTE
DPH    SFR  083H  ;SFR POINTER - HIGH BYTE
GMOD   SFR  084H  ;GSC MODE
TFIFO  SFR  085H  ;GSC TRANSMIT BUFFER
PCON   SFR  087H  ;POWER CONTROL
TCON   SFRB 088H  ;TIMER CONTROL
TMOD   SFR  089H  ;TIMER MODE
TL0    SFR  08AH  ;TIMER 0 - LOW BYTE
TL1    SFR  08BH  ;TIMER 1 - LOW BYTE
TH0    SFR  08CH  ;TIMER 0 - HIGH BYTE
TH1    SFR  08DH  ;TIMER 1 - HIGH BYTE
P1     SFRB 090H  ;PORT 1
P5     SFR  091H  ;PORT 5
DCON0  SFR  092H  ;DMA CONTROL 0
DCON1  SFR  093H  ;DMA CONTROL 1
BAUD   SFR  094H  ;GSC BAUD RATE
ADR0   SFR  095H  ;GSC MATCH ADDRESS 0
SCON   SFRB 098H  ;LSC CONTROL
SBUF   SFR  099H  ;LSC BUFFER
P2     SFRB 0A0H  ;PORT 2
P6     SFR  0A1H  ;PORT 6
SARL0  SFR  0A2H  ;DMA CHANNEL 0 SOURCE ADDRESS - LO BYTE
SARH0  SFR  0A3H  ;DMA CHANNEL 0 SOURCE ADDRESS - HI BYTE
IFS    SFR  0A4H  ;GSC INTERFRAME SPACE
ADR1   SFR  0A5H  ;GSC MATCH ADDRESS 1
IE     SFRB 0A8H  ;INTERRUPT ENABLE REGISTER 0
P3     SFRB 0B0H  ;PORT 3
SARL1  SFR  0B2H  ;DMA CHANNEL 1 SOURCE ADDRESS - LO BYTE
SARH1  SFR  0B3H  ;DMA CHANNEL 1 SOURCE ADDRESS - HI BYTE
SLOTTM SFR  0B4H  ;GSC SLOT TIME
ADR2   SFR  0B5H  ;GSC MATCH ADDRESS 2
IP     SFRB 0B8H  ;INTERRUPT PRIORITY REGISTER 0
P4     SFRB 0C0H  ;PORT 4
DARL0  SFR  0C2H  ;DMA CHANNEL 0 DESTINATION ADDRESS - LO BYTE
DARH0  SFR  0C3H  ;DMA CHANNEL 0 DESTINATION ADDRESS - HI BYTE
BKOFF  SFR  0C4H  ;GSC BACKOFF TIMER
ADR3   SFR  0C5H  ;GSC MATCH ADDRESS 3
IEN1   SFRB 0C8H  ;INTERRUPT ENABLE REGISTER 1
PSW    SFRB 0D0H  ;PROGRAM STATUS WORD
DARL1  SFR  0D2H  ;DMA CHANNEL 1 DESTINATION ADDRESS - LO BYTE
DARH1  SFR  0D3H  ;DMA CHANNEL 1 DESTINATION ADDRESS - HI BYTE
TCDCNT SFR  0D4H  ;GSC XMIT COLLISION COUNTER
AMSK0  SFR  0D5H  ;GSC ADDRESS MASK 0
TSTAT  SFRB 0D8H  ;GSC TRANSMIT STATUS
ACC    SFRB 0E0H  ;ACCUMULATOR
BCRL0  SFR  0E2H  ;DMA BYTE COUNT 0 - LOW BYTE
BCRH0  SFR  0E3H  ;DMA BYTE COUNT 0 - HI BYTE
PRBS   SFR  0E4H  ;GSC PSEUDO-RANDOM SEQUENCE
AMSK1  SFR  0E5H  ;GSC ADDRESS MASK 1
RSTAT  SFRB 0E8H  ;GSC RECEIVE STATUS
B      SFRB 0F0H  ;MULTIPLICATION REGISTER
BCRL1  SFR  0F2H  ;DMA BYTE COUNT 1 - LOW BYTE
BCRH1  SFR  0F3H  ;DMA BYTE COUNT 1 - HI BYTE
RFIFO  SFR  0F4H  ;GSC RECEIVE BUFFER
MYSLOT SFR  0F5H  ;GSC SLOT ADDRESS
IPN1   SFRB 0F8H  ;INTERRUPT PRIORITY REGISTER 1

IT0    BIT   TCON.0     ;EXT. INTERRUPT 0 TYPE
IE0    BIT   TCON.1     ;EXT. INTERRUPT 0 EDGE FLAG
IT1    BIT   TCON.2     ;EXT. INTERRUPT 1 TYPE
IE1    BIT   TCON.3     ;EXT. INTERRUPT 1 EDGE FLAG
TR0    BIT   TCON.4     ;TIMER 0 ON/OFF CONTROL
TF0    BIT   TCON.5     ;TIMER 0 OVERFLOW FLAG
TR1    BIT   TCON.6     ;TIMER 1 ON/OFF CONTROL
TF1    BIT   TCON.7     ;TIMER 1 OVERFLOW FLAG

GRXD   BIT   P1.0       ;GSC RECEIVER DATA
GTXD   BIT   P1.1       ;GSC TRANSMIT DATA
DEN    BIT   P1.2       ;DRIVE ENABLE
TXC    BIT   P1.3       ;GSC TRANSMIT CLOCK
RXC    BIT   P1.4       ;GSC RECEIVE CLOCK
HLD    BIT   P1.5       ;HOLD REQUEST
HLDA   BIT   P1.6       ;HOLD ACKNOWLEDGE

RI     BIT   SCON.0     ;RECEIVE INTERRUPT FLAG
TI     BIT   SCON.1     ;TRANSMIT INTERRUPT FLAG
RB8    BIT   SCON.2     ;RECEIVE BIT 8
TB8    BIT   SCON.3     ;TRANSMIT BIT 8
REN    BIT   SCON.4     ;RECEIVE ENABLE
SM2    BIT   SCON.5     ;SERIAL MODE CONTROL BIT 2
SM1    BIT   SCON.6     ;SERIAL MODE CONTROL BIT 1
SM0    BIT   SCON.7     ;SERIAL MODE CONTROL BIT 0

EX0    BIT   IE.0       ;EXTERNAL INTERRUPT 0 ENABLE
ET0    BIT   IE.1       ;TIMER 0 INTERRUPT ENABLE
EX1    BIT   IE.2       ;EXTERNAL INTERRUPT 1 ENABLE
ET1    BIT   IE.3       ;TIMER 1 INTERRUPT ENABLE
ES     BIT   IE.4       ;SERIAL PORT INTERRUPT ENABLE
EA     BIT   IE.7       ;GLOBAL INTERRUPT ENABLE

RXD    BIT   P3.0       ;SERIAL PORT RECEIVE INPUT
TXD    BIT   P3.1       ;SERIAL PORT TRANSMIT OUTPUT
INT0   BIT   P3.2       ;EXTERNAL INTERRUPT 0 INPUT
INT1   BIT   P3.3       ;EXTERNAL INTERRUPT 1 INPUT
T0     BIT   P3.4       ;TIMER 0 COUNT INPUT
T1     BIT   P3.5       ;TIMER 1 COUNT INPUT
WR     BIT   P3.6       ;WRITE CONTROL FOR EXT. MEMORY
RD     BIT   P3.7       ;READ CONTROL FOR EXT. MEMORY

PX0    BIT   IP.0       ;EXTERNAL INTERRUPT 0 PRIORITY
PT0    BIT   IP.1       ;TIMER 0 PRIORITY
PX1    BIT   IP.2       ;EXTERNAL INTERRUPT 1 PRIORITY
PT1    BIT   IP.3       ;TIMER 1 PRIORITY
PS     BIT   IP.4       ;SERIAL PORT PRIORITY

EGSRV  BIT   IEN1.0     ;GSC RECEIVE VALID INTERRUPT ENABLE
EGSRE  BIT   IEN1.1     ;GSC RECEIVE ERROR INTERRUPT ENABLE
EDMA0  BIT   IEN1.2     ;DMA CHANNEL 0 REQUEST INTERRUPT ENABLE
EGSTV  BIT   IEN1.3     ;GSC TRANSMIT VALID INTERRUPT ENABLE
EDMA1  BIT   IEN1.4     ;DMA CHANNEL 1 REQUEST INTERRUPT ENABLE
EGSTE  BIT   IEN1.5     ;GSC TRANSMIT ERROR INTERRUPT ENABLE

P      BIT   PSW.0      ;ACCUMULATOR PARITY FLAG
F1	   BIT   PSW.1		;FLAG 1
OV     BIT   PSW.2      ;OVERFLOW FLAG
RS0    BIT   PSW.3      ;REGISTER BANK SELECT 0
RS1    BIT   PSW.4      ;REGISTER BANK SELECT 1
F0     BIT   PSW.5      ;FLAG 0
AC     BIT   PSW.6      ;AUXILIARY CARRY FLAG
CY     BIT   PSW.7      ;CARRY FLAG

DMA    BIT   TSTAT.0    ;DMA SELECT
TEN    BIT   TSTAT.1    ;TRANSMIT ENABLE
TFNF   BIT   TSTAT.2    ;TRANSMIT FIFO NOT FULL
TDN    BIT   TSTAT.3    ;TRANSMIT DONE
TCDT   BIT   TSTAT.4    ;TRANSMIT COLLISION DETECT
UR     BIT   TSTAT.5    ;UNDERRUN
NOACK  BIT   TSTAT.6    ;NO ACKNOWLEDGE
LNI    BIT   TSTAT.7    ;LINE IDLE


HBAEN  BIT   RSTAT.0    ;HARDWARE BASED ACKNOWLEDGE ENABLE
GREN   BIT   RSTAT.1    ;RECEIVER ENABLE
RFNE   BIT   RSTAT.2    ;RECEIVE FIFO NO EMPTY
RDN    BIT   RSTAT.3    ;RECEIVE DONE
CRCE   BIT   RSTAT.4    ;CRC ERROR
AE     BIT   RSTAT.5    ;ALIGNMENT ERROR
RCABT  BIT   RSTAT.6    ;RECEIVER COLLISION/ABORT DETECT
OVR    BIT   RSTAT.7    ;OVERRUN


PGSRV  BIT   IPN1.0     ;GSC RECEIVE VALID PRIORITY
PGSRE  BIT   IPN1.1     ;GSC RECEIVE ERROR PRIORITY
PDMA0  BIT   IPN1.2     ;DMA CHANNEL 0 REQUEST PRIORITY
PGSTV  BIT   IPN1.3     ;GSC TRANSMIT VALID PRIORITY
PDMA1  BIT   IPN1.4     ;DMA CHANNEL 1 REQUEST PRIORITY
PGSTE  BIT   IPN1.5     ;GSC TRANSMIT ERROR PRIORITY

bank0		equ		0	;nur der Schînheit halber...
bank1		equ		1
bank2		equ		2
bank3		equ		3

using		macro	bank
				if	(bank<0)||(bank>3)          ;nur 0..3 erlaubt
					error  "bad banknummer: \{BANK}"
				endif

				ifdef	RegUsage	;BuchfÅhrung Åber benutzte BÑnke
RegUsage			set	RegUsage|(2^bank)
				elseif
RegUsage			set	2^bank
				endif

ar0				set	bank*8		;Symbole besetzen
ar1				set	ar0+1
ar2				set	ar0+2
ar3				set	ar0+3
ar4				set	ar0+4
ar5				set	ar0+5
ar6				set	ar0+6
ar7				set	ar0+7
			endm

                endif

		RESTORE		;wieder erlauben
